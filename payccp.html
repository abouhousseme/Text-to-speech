<script>
    async function sendPaymentData() {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const fileInput = document.getElementById('paymentFile');
        const file = fileInput.files[0];

        // تحقق من الحقول المطلوبة
        if (!name || !email || !file) {
            alert('يرجى ملء جميع الحقول!');
            return;
        }

        // قراءة ملف الدفع وتحويله إلى Base64
        const reader = new FileReader();
        reader.onload = async () => {
            const base64File = reader.result.split(',')[1]; // استخراج بيانات الملف

            // إعداد البيانات لإرسالها إلى الخادم
            const paymentData = {
                name: name,
                email: email,
                paymentFile: base64File,
            };

            try {
                const response = await fetch('/api/save-payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(paymentData),
                });

                if (response.ok) {
                    // إعادة التوجيه إلى صفحة الشكر بعد النجاح
                    window.location.href = "thank-you.html";
                } else {
                    alert('حدث خطأ أثناء الإرسال. حاول مرة أخرى.');
                }
            } catch (error) {
                console.error('خطأ في الاتصال بالخادم:', error);
                alert('تعذر الاتصال بالخادم.');
            }
        };

        reader.readAsDataURL(file);
    }
</script>
